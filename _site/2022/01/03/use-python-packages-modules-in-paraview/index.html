<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-126127657-1"></script>
<script>
  var host = window.location.hostname;
  if (host != "127.0.0.1" && host != "localhost")
  {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-126127657-1');
  }
</script>


  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta charset="UTF-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Use and import Python packages and modules inside ParaView (PvPython) &middot; Mojtaba Barzegari
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"> -->
  <link rel="stylesheet" href="/public/css/font.css">
  <link rel="stylesheet" href="/public/css/social.css">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Mathjax Support -->
  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>
</head>


  <body class="theme-base-0d">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>Mojtaba Barzegari</h1>
      <p class="lead"></p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
        <a href="/">Home</a>
      </li>

      

      
      
        
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/about/">About</a>
              </li>
            
          
        
      
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/blog/">Blog</a>
              </li>
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/contact/">Contact</a>
              </li>
            
          
        
      
        
          
        
      
        
          
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/presentations/">Presentations & Posters</a>
              </li>
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/projects/">GitHub Projects</a>
              </li>
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/publications/">Publications</a>
              </li>
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/research/">Research Portfolio</a>
              </li>
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/usefulbooks/">Useful Books and Links</a>
              </li>
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/videos/">Videos</a>
              </li>
            
          
        
      
        
          
            
              <li class="sidebar-nav-item">
                <a href="/whatiuse/">What I Use</a>
              </li>
            
          
        
      

      <li class="sidebar-nav-item"><a href="https://mbarzegary.github.io/research-tech-radar/">Research Technology Radar</a></li>
      <li class="sidebar-nav-item"><a href="http://nbviewer.jupyter.org/github/mbarzegary/MyCV-shortened/blob/main/main.pdf">CV</a></li>
      
      <ul style="margin-left: -15px" class="icon-effect icon-effect-1a">
        <li><a target="_blank" href="https://github.com/mbarzegary" class="icon"><i class="fab fa-github"></i></a></li>
        <li><a target="_blank" href="https://www.linkedin.com/in/mbarzegary/" class="icon"><i class="fab fa-linkedin-in"></i></a></li>
        <li><a target="_blank" href="https://twitter.com/MojBarz" class="icon"><i class="fab fa-twitter"></i></a></li>
        <!-- <li><a target="_blank" href="https://www.instagram.com/mbarzegary/" class="icon"><i class="fab fa-instagram"></i></a></li> -->
        <li><a target="_blank" href="https://www.youtube.com/TuxRiders" class="icon"><i class="fab fa-youtube"></i></a></li>
        <li><a target="_blank" href="https://www.facebook.com/mbarzegary" class="icon"><i class="fab fa-facebook-f"></i></a></li>
      </ul>


      <!-- <li class="sidebar-nav-item"><a href="https://github.com/mbarzegary/mbarzegary.github.io/archive/v.zip">Download</a></li>
      <li class="sidebar-nav-item"><a href="https://github.com/mbarzegary/mbarzegary.github.io">GitHub project</a></li>
      <li class="sidebar-nav-item">Currently v</li> -->
    </ul>

    <p>Copyleft 2022. No right reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post">
  <h1 class="post-title">Use and import Python packages and modules inside ParaView (PvPython)</h1>
  <span class="post-date">03 Jan 2022</span>
  <p>I came across a couple of scenarios in which I needed to call a couple of packages inside <a href="https://www.paraview.org/Wiki/ParaView/Python_Scripting">PvPython</a>, the Python client of <a href="https://www.paraview.org/">ParaView</a>, which allows us to automate ParaView tasks (you may take a look at <a href="">this automation example</a> to see how PvPython works). After trying various techniques in Windows and Linux, my conclusion is that the best solution to this problem is the one suggested <a href="https://discourse.paraview.org/t/how-can-i-install-and-import-other-modules-inside-pvpython/3067">here</a>. But, since this solution is not elaborated and may be difficult to follow, I implement it in this post the way I did it for myself.</p>

<p>Let’s first clarify the problem. ParaView comes with its own Python intrepreter, in which you can easily access ParaView Python package. To give it a try, open a terminal and type <code class="highlighter-rouge">pvpython</code> and then <code class="highlighter-rouge">from paraview.simple import *</code>. This doesn’t give you an error, but if you execute the statement in your local installation of Python, you will face the famous <code class="highlighter-rouge">ModuleNotFoundError</code>. Now, the problem we want to discuss is the opposite of this one: we cannot use installed packages (like pandas or matplotlib) in PvPython, a scenario that can be very helpful in different applications.</p>

<p>You may think to yourself that the solution is quite obvious and simple: create a Python virtual environment (for example, using <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">conda</a> or <a href="https://docs.python.org/3/tutorial/venv.html">venv</a>) and execute PvPtyhon inside it. I should say that your solution is more or less correct, but it needs a major rearrangement. When you run Python inside a virtual environment, you run the interpreter that is installed inside the virtual environment. So, it means if you run PvPython inside a virtual environment, it cannot see and use the installed packages because it is NOT the interpreter the virtual environment is configured for. So, as I said, the solution is a little bit different from the initial idea: we need to activate a virtual environment while we are inside Python (in this case, inside PvPython). By doing this, the virtual environment launch script will configure the path (I mean <code class="highlighter-rouge">PYTHONPATH</code>) to point to the installed packages of the environment, and we will be able to use them inside our PvPython automation script.</p>

<p>I think the description is a little bit confusing, no? Let’s do that in action and see how it works. We may go on with the virtual environment manager of our choice, but we should keep in mind that it should be easy to activate inside a Python script. As far as I got after a couple of searches, <code class="highlighter-rouge">conda</code> and <code class="highlighter-rouge">venv</code> environments are difficult to activate programmatically, so we use <code class="highlighter-rouge">virtualenv</code> since using it, all we need to do is call an activation script.</p>

<p>Let’s assume that the script we want to run is as simple as this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">paraview.simple</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div></div>

<p>which means that we are going to use the pandas package in a ParaView script (this was actually the use case for which I started to seek a solution). If you run this script using a normal Python executable, you will face the <code class="highlighter-rouge">ModuleNotFoundError: No module named 'paraview'</code>, while running it using PvPython results in <code class="highlighter-rouge">ModuleNotFoundError: No module named 'pandas'</code>. So, it’s time for magic. First, we should install <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-m</span> pip <span class="nb">install</span> <span class="nt">--user</span> virtualenv
</code></pre></div></div>
<p>Then, we need a virtual environment. We can create it in the same location as our script for easier access (in this case, inside a directory called <code class="highlighter-rouge">venv</code>)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-m</span> virtualenv venv
</code></pre></div></div>

<p>Now, it’s time to activate the environment and install the required packages inside it. We can activate the environment by executing</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">source</span> ./venv/bin/activate
</code></pre></div></div>
<p>in Linux and</p>
<pre><code class="language-cmd">&gt; .\venv\Scripts\activate
</code></pre>
<p>in Windows. As I said before, we want to use pandas in this example, so let’s install it (make sure that the environment is activated):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pip <span class="nb">install </span>pandas
</code></pre></div></div>

<p>We are done with the environment, so we can deactivate it and come back to the normal shell. The last step is to modify the script to activate the environment when the it runs. To generalize the code, we pass the path of the environment as an argument in the command line (named <code class="highlighter-rouge">virtual-env</code>) so that the script can work with different environments if needed. The script should be modified like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="k">if</span> <span class="s">'--virtual-env'</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
  <span class="n">virtualEnvPath</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">'--virtual-env'</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
  <span class="c1"># Linux
</span>  <span class="n">virtualEnv</span> <span class="o">=</span> <span class="n">virtualEnvPath</span> <span class="o">+</span> <span class="s">'/bin/activate_this.py'</span>
  <span class="c1"># Windows
</span>  <span class="c1"># virtualEnv = virtualEnvPath + '/Scripts/activate_this.py'
</span>  <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="o">.</span><span class="n">major</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">execfile</span><span class="p">(</span><span class="n">virtualEnv</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">__file__</span><span class="o">=</span><span class="n">virtualEnv</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">virtualEnv</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="p">{</span><span class="s">'__file__'</span><span class="p">:</span> <span class="n">virtualEnv</span><span class="p">})</span>

<span class="c1"># The main script starts from here
</span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="nn">paraview.simple</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div></div>

<p>What the added code does is simple. It looks for the path of the environment and runs the activation script, meaning that the environment gets activated while the script is being interpreted by Python. Make sure to adapt the code if you want to use it under Windows. The script can be executed like this (assuming the script is named <code class="highlighter-rouge">my_script.py</code> and the environment was created according to the above instruction in a directory called <code class="highlighter-rouge">venv</code>):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pvpython my_script.py <span class="nt">--virtual-env</span> venv
</code></pre></div></div>

<p>You should be able to run the script without any error, meaning that PvPython can see and use the pandas package installed in our virtual environment.</p>

</div>

<!-- <div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2022/11/14/derive-weak-form-pde-navier-stokes/">
            Weak (variational) formulation of Navier-Stokes equation
            <small>14 Nov 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2022/10/27/high-performance-computing-scaling-challenge/">
            High-performance computing&#58; challenges of performance tuning and scaling of finite element models
            <small>27 Oct 2022</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2022/06/27/surface-to-volume-mesh-using-gmsh/">
            Generate volume mesh from a surface mesh using GMSH
            <small>27 Jun 2022</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div> -->

    </div>

  </body>
</html>
